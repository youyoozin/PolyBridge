{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <div class="row g-4 mb-4">
    <!-- ë‹¨ì²´ ì±„íŒ…ë°© ì¹´ë“œ -->
    <div class="col-md-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body text-center">
          <div style="font-size:2.5rem;">ğŸ’¬</div>
          <h5 class="card-title mt-2">ë‹¨ì²´ ì±„íŒ…ë°©</h5>
          <p class="card-text">ëª¨ë‘ê°€ ì°¸ì—¬í•˜ëŠ” ì‹¤ì‹œê°„ ë‹¨ì²´ ì±„íŒ…ë°©ì…ë‹ˆë‹¤.</p>
          <a href="/chatroom" class="btn btn-success w-100">ì…ì¥í•˜ê¸°</a>
        </div>
      </div>
    </div>
    <!-- 1:1 ì±„íŒ…ë°© ì¹´ë“œ -->
    <div class="col-md-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body text-center">
          <div style="font-size:2.5rem;">ğŸ‘¤</div>
          <h5 class="card-title mt-2">ìµëª… 1:1 ì±„íŒ…ë°©</h5>
          <p class="card-text">ìµëª…ìœ¼ë¡œ 1:1 ëŒ€í™”ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆëŠ” ê³µê°„ì…ë‹ˆë‹¤.</p>
          <a href="#" onclick="showPrivateChatModal()" class="btn btn-primary w-100">ì…ì¥í•˜ê¸°</a>
        </div>
      </div>
    </div>
    <!-- ê²Œì‹œíŒ ì¹´ë“œ -->
    <div class="col-md-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body text-center">
          <div style="font-size:2.5rem;">ğŸ“°</div>
          <h5 class="card-title mt-2">ê²Œì‹œíŒ</h5>
          <p class="card-text">ì •ì¹˜, ììœ , í† ë¡  ë“± ë‹¤ì–‘í•œ ê²Œì‹œíŒì„ ì´ìš©í•˜ì„¸ìš”.</p>
          <a href="#post-list" class="btn btn-outline-secondary w-100">ê²Œì‹œê¸€ ë³´ê¸°</a>
        </div>
      </div>
    </div>
    <!-- ë§ˆì´í˜ì´ì§€ ì¹´ë“œ -->
    <div class="col-md-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body text-center">
          <div style="font-size:2.5rem;">ğŸ™â€â™‚ï¸</div>
          <h5 class="card-title mt-2">ë§ˆì´í˜ì´ì§€</h5>
          <p class="card-text">ë‚´ ì •ë³´, ë‚´ ê¸€, ë‚´ ëŒ“ê¸€ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <a href="/mypage" class="btn btn-outline-info w-100">ë§ˆì´í˜ì´ì§€</a>
        </div>
      </div>
    </div>
    <!-- ìë£Œì‹¤ ì¹´ë“œ -->
    <div class="col-md-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body text-center">
          <div style="font-size:2.5rem;">ğŸ“</div>
          <h5 class="card-title mt-2">ìë£Œì‹¤</h5>
          <p class="card-text">ìœ ìš©í•œ ìë£Œì™€ ì •ë³´ë¥¼ ê³µìœ í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.</p>
          <a href="#" class="btn btn-outline-warning w-100">ìë£Œì‹¤ ê°€ê¸°</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 1:1 ì±„íŒ…ë°© ì…ì¥ ëª¨ë‹¬ -->
<div class="modal fade" id="privateChatModal" tabindex="-1" aria-labelledby="privateChatModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="privateChatModalLabel">1:1 ì±„íŒ…ë°© ì…ì¥</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="text" id="privateChatTarget" class="form-control" placeholder="ìƒëŒ€ë°© ë‹‰ë„¤ì„ ë˜ëŠ” ì´ë¦„ ì…ë ¥">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
        <button type="button" class="btn btn-primary" onclick="goPrivateChat()">ì…ì¥</button>
      </div>
    </div>
  </div>
</div>

<div id="post-list" class="container mt-5">
  <h3 class="mb-4">ê²Œì‹œê¸€ ëª©ë¡</h3>
  <div class="row g-4">
    {% for post in posts %}
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="card-title mb-0"><a href="/post/{{ post.id }}">{{ post.title }}</a></h5>
            <span class="badge bg-info text-dark">ì¢‹ì•„ìš” <span id="like-count-{{ post.id }}">{{ post.likes }}</span></span>
          </div>
          <p class="card-text text-secondary">{{ post.content[:80] }}{% if post.content|length > 80 %}...{% endif %}</p>
          <div class="mb-2">
            <span class="badge bg-secondary">ì¶œì²˜: {{ post.source }}</span>
            <span class="badge bg-light text-dark">ì‘ì„±ì¼: {{ post.created_at.strftime('%Y-%m-%d') }}</span>
            <span class="badge bg-primary">ì‘ì„±ì: {{ post.user.name if post.user else post.user_id }}</span>
          </div>
          <div class="d-flex align-items-center gap-2">
            <button class="btn btn-sm btn-outline-danger" onclick="likePost('{{ post.id }}')">ì¢‹ì•„ìš”</button>
            {% if session.get('user_id') == post.user_id %}
            <form method="post" action="/delete/{{ post.id }}" style="display:inline;" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
              <button type="submit" class="btn btn-sm btn-outline-secondary ms-2">ì‚­ì œ</button>
            </form>
            {% endif %}
            <a href="/chat/{{ post.title }}" class="btn btn-sm btn-success ms-2">ì´ ê¸€ ì£¼ì œ ì±„íŒ…ë°©</a>
            {% if post.user_id and session.get('user_id') != post.user_id %}
            <a href="/chat/{{ post.user.name if post.user else post.user_id }}" class="btn btn-sm btn-outline-primary ms-2">ì‘ì„±ìì™€ 1:1 ì±„íŒ…</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <p>ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endfor %}
  </div>
</div>

<div class="mt-5">
  <h3>ì‹¤ì‹œê°„ ì¸ê¸° ê²€ìƒ‰ì–´</h3>
  <div class="d-flex flex-wrap gap-2">
    {% for kw in trending_keywords %}
      <a href="/search/{{ kw }}" class="btn btn-outline-primary">{{ kw }}</a>
      <a href="/chat/{{ kw }}" class="btn btn-outline-success">ì±„íŒ…ë°©</a>
    {% endfor %}
  </div>
</div>
<script type="text/javascript">
function likePost(postId) {
  fetch('/like/' + postId, {method: 'POST'})
    .then(function(response) { return response.json(); })
    .then(function(data) {
      document.getElementById('like-count-' + postId).innerText = data.likes;
    });
}

// 1:1 ì±„íŒ…ë°© ëª¨ë‹¬
function showPrivateChatModal() {
  var modal = new bootstrap.Modal(document.getElementById('privateChatModal'));
  document.getElementById('privateChatTarget').value = '';
  modal.show();
}
function goPrivateChat() {
  var target = document.getElementById('privateChatTarget').value.trim();
  if(target) {
    window.location.href = '/chat/' + encodeURIComponent(target);
  }
}

</script>
{% endblock %}

